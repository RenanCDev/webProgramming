<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link href="styles/style-index.css" rel="stylesheet">
    <title>Receita 07 Programming Web</title>
</head>
<body>
    <div id="test">
        <button id="loadButton">
            <h1>Load Beers</h1>
        </button>
        <button id="sortBeer">
            <h1>Sort Beers</h1>
        </button>
        <button id="shuffleBeers">
            <h1>Shuffle Beers</h1>
        </button>
    </div>
    <div id="printBeers">
        <div id="beersDiv">
        </div>
    </div>

    <script>
        let beers = [];

        const loadDiv = (targetId = "beersDiv", headers = ["ID","Brand","Nome","Estílo","HOP","Ano","Malte","IBU","Álcool","BLG"], properties = ["id","brand","name","style","hop","yeast","malts","ibu","alcohol","blg"]) => {
            const targetElement = document.getElementById(targetId);
            const button = document.getElementById("loadButton");

            const isLoaded = button.getAttribute("data-loaded") === "true";

            if (!isLoaded) {
                renderBeers(beers, targetId, headers, properties);
                button.querySelector("h1").textContent = "Unload Beers";
                button.setAttribute("data-loaded", "true");
            } else {
                targetElement.innerHTML = "";
                button.querySelector("h1").textContent = "Load Beers";
                button.setAttribute("data-loaded", "false");
            }
        }

        async function loadBeers () {
            const beersDiv = document.getElementById("beersDiv");
            const button = document.getElementById("loadButton");

            const isLoaded = button.getAttribute("data-loaded") === "true";

            if (isLoaded) {
                beersDiv.innerHTML = "";
                button.querySelector("h1").textContent = "Load Beers";
                button.setAttribute("data-loaded", "false");
                beers = [];
            } else {
                try{
                    let res = await fetch("https://random-data-api.com/api/v2/beers?size=25");
                    beers = await res.json();
                    loadDiv("beersDiv");
                }catch(err){
                    document.getElementById("beersDiv").innerHTML = "ERROR!!!";
                }
            }
        }


        const renderBeers = (list, targetId = "beersDiv", headers = ["ID","Brand","Nome","Estílo","HOP","Ano","Malte","IBU","Álcool","BLG"], properties = ["id","brand","name","style","hop","yeast","malts","ibu","alcohol","blg"]) => {
            const targetElement = document.getElementById(targetId);
            if (!targetElement) return;

            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            ${headers.map(header => `<th>${header}</th>`).join("")}
                        </tr>
                    </thead>
                    <tbody>
                        ${list.map(item => 
                            `<tr>
                                ${properties.map(prop => `<td>${item[prop] || ""}</td>`).join("")}
                            </tr>`
                        ).join("\n")}
                    </tbody>
                </table>
            `;

            targetElement.innerHTML = tableHtml;
        }

        const sortBeers = () => {
            if (beers.length === 0) {
                document.getElementById("beersDiv").innerHTML = "ERROR!!!";
                return;
            }
            beers = beers.sort((a, b) => a.name.localeCompare(b.name));
            renderBeers(beers);
        }

        const shuffleBeers = () => {
            if (beers.length === 0) {
                document.getElementById("beersDiv").innerHTML = "ERROR!!!";
                return;
            }
            beers = beers.sort(() => Math.random() - 0.5); 
            renderBeers(beers);  
        }

        document.getElementById("loadButton").addEventListener("click", loadBeers);
        document.getElementById("sortBeer").addEventListener("click", sortBeers);
        document.getElementById("shuffleBeers").addEventListener("click", shuffleBeers);
    </script>
</body>
</html>
